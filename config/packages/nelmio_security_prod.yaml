nelmio_security:
    # --- Mode production compatible RA / Webpack / Tailwind ---
    csp:
        enabled: true

        hosts: [ ]
        content_types: [ ]

        enforce:
            default-src:
                - "'self'"

            script-src:
                - "'self'"
                - "'unsafe-inline'"       # nécessaire à Stimulus/Twig inline event
                - "'unsafe-eval'"         # nécessaire à A-Frame et MindAR
                - "https://aframe.io"
                - "https://cdn.jsdelivr.net"
                - "https://unpkg.com"
                - "https://cdnjs.cloudflare.com"

            worker-src:
                - "'self'"
                - "blob:"  # nécessaire à MindAR même en production

            style-src:
                - "'self'"
                - "'unsafe-inline'"       # pour les styles inline de Tailwind ou Stimulus
                - "https://fonts.googleapis.com"

            font-src:
                - "'self'"
                - "https://fonts.gstatic.com"
                - "data:"

            img-src:
                - "'self'"
                - "data:"
                - "blob:"
                - "https://aframe.io"
                - "https://cdn.jsdelivr.net"
                - "https://unpkg.com"
                - "https://cdnjs.cloudflare.com"
                - "https://*"             # pour les images hébergées externes ou sous-domaines
                - "http://127.0.0.1:*"    # utile en dev / preview locale

            connect-src:
                - "'self'"
                - "blob:"
                - "data:"
                - "http://127.0.0.1:*"
                - "http://localhost:*"
                - "ws://127.0.0.1:*"
                - "https://aframe.io"
                - "https://cdn.jsdelivr.net"
                - "https://unpkg.com"
                - "https://storage.googleapis.com"
                - "https://mediapipe.dev"
                - "https://*.googleusercontent.com"

            media-src:
                - "'self'"
                - "data:"
                - "blob:"

            frame-src:
                - "'self'"
                - "https://*"  # autorise intégrations iframe externes (YouTube, etc.)

            object-src:
                - "'none'"

            # Journaliser les violations CSP :
            report-uri:
                - "/csp-report"

    # --- Permissions Policy ---
    permissions_policy:
        enabled: true
        policies:
            camera: ['self']
            microphone: ['self']
            geolocation: ['self']
            fullscreen: ['self']
            payment: [ ]
            usb: [ ]

    # --- Sécurités complémentaires ---
    clickjacking:
        paths:
            '^/': SAMEORIGIN

    xss_protection:
        enabled: true
        mode_block: true

    referrer_policy:
        enabled: true
        policies:
            - 'strict-origin-when-cross-origin'
