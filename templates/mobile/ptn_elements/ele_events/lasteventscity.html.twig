{% for group in events %}
    {% set col = loop.index0 < 3 ? loop.index0 : 3 %}
    {% set potin = group.potin %}
    {% set primaryEvent = group.primaryEvent %}
    {% set featuredLocation = group.events|first %}
    {% set bookingEvent = featuredLocation ? featuredLocation.bookingEvent : primaryEvent %}
    {% set featuredDate = group.nextDate ?? (featuredLocation ? featuredLocation.nextDate : null) %}
    {% set bookingDate = featuredDate ?? bookingEvent.appointment.starttime ?? primaryEvent.appointment.starttime %}

    <div class="mb-event_card color-event-{{ col }}">

        <div class="mb-event-media">
            <div class="e_pictfull_card">
                {% if potin is not null and potin.media.imagejpg|length > 0 and potin.media.imagejpg[0].namefile is defined %}
                    <div class="pict_event" style="background-image: url('{{ asset('upload/module/'~potin.media.imagejpg[0].namefile) }}')"></div>
                {% elseif bookingEvent.media is defined and bookingEvent.media.imagejpg|length > 0 and bookingEvent.media.imagejpg[0].namefile is defined %}
                    <img src="{{ asset(bookingEvent.media.imagejpg[0].getWebPath) }}" alt="image affiche">
                {% endif %}
            </div>
            {% if bookingDate %}

                <div class="mb-event-dateBadge">
                    <span class="mb-event-date">{{ bookingDate|date('d/m') }}</span>
                    <span class="mb-event-time">{{ bookingDate|date('H\hi') }}</span>
                </div>
            {% endif %}
        </div>

        <div class="mb-event-content">
            <div class="mb-event-meta">
                {% if potin.agepotin is defined and potin.agepotin is not null %}
                    <span class="mb-event-age">Dès {{ potin.agepotin }} ans</span>
                {% endif %}
                {% if bookingDate %}
                    <span class="mb-event-duration">À partir du {{ bookingDate|date('d/m/Y') }}</span>
                {% endif %}
            </div>
            <h3 class="mb-event-title" title="evenement de {{ potin.titre }}">{{ potin.titre|lower|capitalize }}</h3>
            {% if primaryEvent.description is defined and primaryEvent.description is not same as (" ") %}
                <p class="mb-event-description">{{ primaryEvent.description|raw|lower|capitalize }}</p>
            {% endif %}
            <div class="mb-event-infos">
                {% if bookingDate %}
                    <div class="mb-event-info-item">
                        <svg xmlns="http://www.w3.org/2000/svg" focusable="false" role="img" fill="currentColor" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="info-svg">
                            <path d="M7 2a1 1 0 011 1v1h8V3a1 1 0 112 0v1h1.5A2.5 2.5 0 0122 6.5v13A2.5 2.5 0 0119.5 22h-15A2.5 2.5 0 012 19.5v-13A2.5 2.5 0 014.5 4H6V3a1 1 0 011-1zm12.5 6h-15c-.276 0-.5.224-.5.5V19.5c0 .276.224.5.5.5h15a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5zM7 11h4a1 1 0 110 2H7a1 1 0 010-2z"></path>
                        </svg>
                        <span class="ptn-inf2">{{ bookingDate|date('d/m/Y \à H\hi') }}</span>
                    </div>
                {% endif %}
                {% if group.events|length > 0 %}
                    <div class="mb-event-info-item">
                        <svg xmlns="http://www.w3.org/2000/svg" focusable="false" role="img" fill="currentColor" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="info-svg">
                            <path d="M12 2a7 7 0 017 7c0 4.418-4.03 8.5-6.315 10.512a1 1 0 01-1.37 0C9.03 17.5 5 13.418 5 9a7 7 0 017-7zm0 9.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path>
                        </svg>
                        <div class="ptn-inf2">
                            {% for location in group.events %}
                                {% set board = location.board %}
                                <div class="mb-event-location">
                                    {% if board %}
                                        <span class="mb-event-location-name">{{ board.nameboard }}</span>
                                        {% if board.locality is defined and board.locality %}
                                            <span class="mb-event-location-city"> — {{ board.locality.city }}</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="mb-event-location-name">Médiathèque à confirmer</span>
                                    {% endif %}
                                    {% if location.dates|length > 0 %}
                                        <span class="mb-event-location-dates">
                                                {% for label, dateObj in location.dates %}
                                                    {{ dateObj|date('d/m/Y') }}{% if not loop.last %}, {% endif %}
                                                {% endfor %}
                                        </span>
                                    {% else %}
                                        <span class="mb-event-location-dates">Dates à venir</span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="mb-event-actions">
                {% if customer is defined and customer is not null %}
                    {% if is_granted("ROLE_MEDIA") %}
                        <a href="{{ path('back_admin_cmd_potins',{'id':bookingEvent.id}) }}" class="mb-event-button" title="rendez-vous">Réservez</a>
                    {% else %}
                        {% set potinId = potin.id ?? null %}
                        {% set potinSlug = (potin.slug ?? null) ?: (potinId ? 'potin-' ~ potinId : 'potin') %}
                        {% if potinId %}
                            <a href="{{ path('show_potin',{'slug':potinSlug,'id':potinId}) }}" class="mb-event-button" title="rendez-vous">Découvrir l'atelier</a>
                            <a href="{{ path('show_potin',{'slug':potinSlug,'id':potinId}) }}" class="mb-event-button" title="rendez-vous">Voir le détail</a>                   <a href="{{ path('show_event_id',{'id':potin.id}) }}" class="mb-event-button" title="rendez-vous">Voir le détail</a>
                    {% endif %}
                {% else %}
                    {% set potinId = potin.id ?? null %}
                    {% set potinSlug = (potin.slug ?? null) ?: (potinId ? 'potin-' ~ potinId : 'potin') %}
                    {% if potinId %}
                        <a href="{{ path('show_potin',{'slug':potinSlug,'id':potinId}) }}" class="mb-event-button" title="rendez-vous">Découvrir l'atelier</a>
                        <a href="{{ path('show_potin',{'slug':potinSlug,'id':potinId}) }}" class="mb-event-button" title="rendez-vous">Voir le détail</a>    <a href="{{ path('show_event_id',{'id':potin.id}) }}" class="mb-event-button" title="rendez-vous">Voir le détail</a>
                {% endif %}
            </div>
        </div>
    </div>
{% else %}
    <div class="flex-board">
        <div class="flex-notb_v6-fix">
            <h3>  Pas de nouveau potin programmé actuellement</h3>
        </div>
    </div>
{%  endfor %}
