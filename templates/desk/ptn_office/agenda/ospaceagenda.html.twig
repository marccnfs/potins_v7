{% block body %}
    <div class="_wb">
        <div class="container_bo_member">
            {{ include('desk/ptn_office/menu/websitemenu.html.twig') }}
            <div class="bo_content">
                <header class="dashboard-header">
                    <span class="dashboard-kicker">Suivi hebdomadaire</span>
                    <h1 class="dashboard-title">Agenda CNFS</h1>
                    <p class="dashboard-subtitle">Visualisez les ateliers planifiés cette semaine et accédez rapidement aux demandes de rendez-vous.</p>
                </header>

                {{ include('desk/ptn_office/partials/_alerts.html.twig') }}

                <section class="dashboard-card">
                    <h2 class="dashboard-card__title">Planifier un créneau</h2>
                    <p>Créez vos rendez-vous publics directement depuis l’outil agenda. Le formulaire vous permet de :</p>
                    <ul class="dashboard-list">
                        <li>choisir la commune d’intervention ;</li>
                        <li>définir le type d’activité (RDV public, atelier collectif, permanence, formation, indisponibilité…);</li>
                        <li>renseigner la date, l’horaire et la durée ;</li>
                        <li>bloquer un créneau en cas d’absence ou de congés.</li>
                    </ul>
                    <p>
                        <a class="btn" href="{{ path('event_new') }}">Ajouter un créneau à l’agenda</a>
                    </p>
                </section>

                <section class="dashboard-card">
                    {{ include('desk/ptn_public/agenda/board_week.html.twig', {
                        date: date,
                        show_requests: false,
                        manage: true,
                        context: 'office'
                    }, with_context = false) }}
                </section>
                <section class="dashboard-card">
                    <div class="dashboard-card__header">
                        <h2 class="dashboard-card__title">Demandes récentes</h2>
                        <a class="btn btn-light" href="{{ path('module_agenda_requests') }}">Voir toutes les demandes</a>
                    </div>

                    {% if recentRequests is not empty %}
                        <ul class="dashboard-requests">
                            {% for request in recentRequests %}
                                {% set profile = request.contact.useridentity %}
                                <li class="dashboard-request">
                                    <header class="dashboard-request__header">
                                        <div>
                                            <span class="dashboard-request__title">{{ profile.firstname ? profile.firstname ~ ' ' ~ profile.lastname : request.contact.emailCanonical }}</span>
                                            <span class="dashboard-request__meta">{{ request.createAt|date('d/m/Y \à H\hi') }}</span>
                                        </div>
                                        <span class="badge">{{ request.city|default('Commune à préciser') }}</span>
                                    </header>
                                    <p class="dashboard-request__subject">{{ request.titre }}</p>
                                    <p class="dashboard-request__body">{{ request.text|nl2br }}</p>
                                    <ul class="dashboard-request__contact">
                                        <li><strong>Email :</strong> {{ profile.emailsecours ?? request.contact.emailCanonical }}</li>
                                        <li><strong>Téléphone :</strong> {{ profile.telephonemobile ?? 'Non communiqué' }}</li>
                                    </ul>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="muted">Aucune demande reçue depuis l’agenda public pour le moment.</p>
                    {% endif %}
                </section>
            </div>
        </div>
    </div>
{% endblock %}
{% use "js/js_agenda.html.twig" %}
{% block javascripts %}
    {{ parent() }}
{% endblock %}
