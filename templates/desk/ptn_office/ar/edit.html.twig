{% block body %}
    <div class="_wb">
        <div class="container_bo_member">
            {{ include('desk/ptn_office/menu/websitemenu.html.twig') }}
            <div class="bo_content">
                <header class="dashboard-header">
                    <span class="dashboard-kicker">Pack MindAR</span>
                    <h1 class="dashboard-title">Modifier le pack {{ pack.name }}</h1>
                    <p>Mettre à jour les fichiers MindAR, médias associés et images cibles.</p>
                </header>

                {{ include('desk/ptn_office/partials/_alerts.html.twig') }}

                {{ include('desk/ptn_office/ar/_form.html.twig', {
                    form: form,
                    submit_label: 'Mettre à jour',
                    title: 'Edition du pack',
                    pack: pack,
                    existingModels: existingModels|default([]),
                    existingTargets: existingTargets|default([])
                }) }}
            </div>
        </div>
    </div>
{% endblock body %}
{% use "js/js_customer.html.twig" %}
{% block javascripts %}
    {{ parent() }}
    <script>
        (function () {
            const fileInput = document.querySelector('#{{ form.thumbnail.vars.id }}');
            const preview = document.getElementById('thumbnail-preview');
            const image = preview ? preview.querySelector('img') : null;
            const resetButton = document.getElementById('thumbnail-preview-reset');

            if (!fileInput || !preview || !image || !resetButton) {
                return;
            }

            const clearPreview = () => {
                preview.hidden = true;
                image.removeAttribute('src');
                image.removeAttribute('data-filename');
                fileInput.value = '';
            };

            fileInput.addEventListener('change', (event) => {
                const [file] = event.target.files ?? [];
                if (!file) {
                    clearPreview();
                    return;
                }

                const reader = new FileReader();
                reader.onload = () => {
                    image.src = reader.result;
                    image.dataset.filename = file.name;
                    preview.hidden = false;
                };
                reader.readAsDataURL(file);
            });

            resetButton.addEventListener('click', (event) => {
                event.preventDefault();
                clearPreview();
            });
        })();
    </script>
{% endblock %}
