{% set locationData = location is defined ? location : event %}
{% set bookingEvent = locationData.bookingEvent ?? locationData.event ?? locationData %}
{% set board = locationData.board ?? bookingEvent.locatemedia ?? null %}
{% set appointment = bookingEvent.appointment ?? null %}
{% set appointmentTimestamp = appointment and appointment.starttime ? appointment.starttime|date('U') : null %}
{% set fallbackDate = locationData.nextDate ?? (appointment and appointment.starttime ? appointment.starttime : null) %}
{% set rawDates = locationData.dates is defined ? locationData.dates : [] %}
{% if rawDates is empty and fallbackDate %}
    {% set rawDates = { (fallbackDate|date('d/m/Y')): fallbackDate } %}
{% endif %}

{% set firstDate =
    (locationData ? attribute(locationData, 'nextDate', [], 'any', false, true) : null)
    ?: (rawDates|first|default(fallbackDate))
%}

{% set baseColor = colorIndex ?? 0 %}

  {% for label, datep in rawDates %}
      {% set cardIndex = baseColor + loop.index0 %}
      {% set col = cardIndex % 4 %}
      {% set dateTimestamp = datep ? datep|date('U') : (firstDate ? firstDate|date('U') : null) %}
      <div class="widget_event_card_date color-event-{{ col }}">
          <div class="widget_inner-event">
              <div class="info_dat">

                  {% if customer is not null %}
                      <nav class="relational_relat">
                          {% if is_granted('ROLE_MEDIA') %}
                              <a href="{{ path('resa_potins_media',{
                                  'id': bookingEvent.id,
                                  'date': dateTimestamp ?? appointmentTimestamp
                              }) }}" class="nav1 btn  hide-on-mobile" title="rendez-vous">Réservez</a>
                          {% else %}
                              <a href="{{ path('back_admin_cmd_potins',{'id':bookingEvent.id}) }}"
                                 class="nav1 btn  hide-on-mobile" title="rendez-vous">Réservez</a>
                          {% endif %}
                      </nav>
                  {% else %}
                      <nav class="relational_relat">
                          {% if dateTimestamp %}
                              <a href="{{ path('resa_potins_public',{'id':bookingEvent.id,'timestamp':dateTimestamp}) }}"
                                 class="nav1 btn  hide-on-mobile" title="Réservez votre place">Réservez</a>
                          {% else %}
                              <span class="nav1 btn disabled">Complet</span>
                          {% endif %}
                      </nav>
                  {% endif %}


                  <div class="event-locate">
                      <div class="event-dates">
                          <svg xmlns="http://www.w3.org/2000/svg" focusable="false" role="img" fill="currentColor"
                               width="700pt" height="700pt" viewBox="0 0 700 700" aria-hidden="true" class="info-svg">
                              <g>
                                  <path
                                      d="m265.44 63.281c-10.641 0-19.602 8.9609-19.602 19.602v8.3984h-34.16c-41.441 0-75.602 34.16-75.602 75.602v267.68c0 41.441 34.16 75.602 75.602 75.602h276.08c41.441 0 75.602-34.16 75.602-75.602v-267.68c0-41.441-34.16-75.602-75.602-75.602h-34.16v-8.3984c0-10.641-8.9609-19.602-19.602-19.602s-19.602 8.9609-19.602 19.602v8.3984l-129.36 0.003906v-8.3984c0-10.645-8.3984-19.602-19.598-19.602zm222.88 408.24h-276.64c-20.16 0-36.398-16.238-36.398-36.398v-192.08h348.88v191.52c0.55859 20.723-15.68 36.961-35.84 36.961zm-73.359-341.04v8.3984c0 10.641 8.9609 19.602 19.602 19.602s19.602-8.9609 19.602-19.602v-8.3984h34.16c20.16 0 36.398 16.238 36.398 36.398v36.961h-349.44v-36.961c0-20.16 16.238-36.398 36.398-36.398h34.16v8.3984c0 10.641 8.9609 19.602 19.602 19.602s19.602-8.9609 19.602-19.602v-8.3984z"/>
                                  <path
                                      d="m311.92 285.6c-0.55859-1.1211-1.1211-2.2383-1.6797-3.3594-0.55859-1.1211-1.6797-2.2383-2.2383-2.8008-1.1211-1.1211-1.6797-1.6797-2.8008-2.2383s-2.2383-1.1211-3.3594-1.6797c-1.1211-0.55859-2.2383-0.55859-3.9219-1.1211-2.8008-0.55859-5.0391-0.55859-7.8398 0-1.1211 0.55859-2.2383 0.55859-3.9219 1.1211-1.6797 0.55859-2.2383 1.1211-3.3594 1.6797-1.1211 0.55859-2.2383 1.6797-2.8008 2.2383-1.1211 1.1211-1.6797 1.6797-2.2383 2.8008-0.55859 1.1211-1.1211 2.2383-1.6797 3.3594-0.55859 1.1211-1.1211 2.2383-1.1211 3.9219 0 1.1211-0.55859 2.8008-0.55859 3.9219 0 5.0391 2.2383 10.078 5.6016 14 1.1211 1.1211 1.6797 1.6797 2.8008 2.2383 1.1211 0.55859 2.2383 1.1211 3.3594 1.6797 1.1211 0.55859 2.2383 1.1211 3.9219 1.1211 1.1211 0 2.8008 0.55859 3.9219 0.55859 1.1211 0 2.8008 0 3.9219-0.55859 1.1211 0 2.8008-0.55859 3.9219-1.1211 1.1211-0.55859 2.2383-1.1211 3.3594-1.6797 1.1211-0.55859 2.2383-1.6797 2.8008-2.2383 3.9219-3.3594 5.6016-8.9609 5.6016-14 0-1.1211 0-2.8008-0.55859-3.9219-0.015626-1.6836-0.57422-2.8047-1.1328-3.9219z"/>
                                  <path
                                      d="m336 279.44c-3.3594 3.9219-5.6016 8.9609-5.6016 14 0 5.0391 2.2383 10.078 5.6016 14 3.9219 3.9219 8.9609 5.6016 14 5.6016 1.1211 0 2.8008 0 3.9219-0.55859 1.1211 0 2.8008-0.55859 3.9219-1.1211 1.1211-0.55859 2.2383-1.1211 3.3594-1.6797s2.2383-1.6797 2.8008-2.2383c1.1211-1.1211 1.6797-1.6797 2.2383-2.8008 0.55859-1.1211 1.1211-2.2383 1.6797-3.3594s1.1211-2.2383 1.1211-3.9219c0-1.1211 0.55859-2.8008 0.55859-3.9219 0-5.0391-2.2383-10.078-5.6016-14-7.2812-7.8398-20.719-7.8398-28 0z"/>
                                  <path
                                      d="m423.92 285.6c-0.55859-1.1211-1.1211-2.2383-1.6797-3.3594-0.55859-1.1211-1.6797-2.2383-2.2383-2.8008-4.4805-4.4805-11.199-6.7188-17.922-5.6016-1.1211 0.55859-2.2383 0.55859-3.9219 1.1211-1.6797 0.55859-2.2383 1.1211-3.3594 1.6797-1.1211 0.55859-2.2383 1.6797-2.8008 2.2383-1.1211 1.1211-1.6797 1.6797-2.2383 2.8008-0.55859 1.1211-1.1211 2.2383-1.6797 3.3594-0.55859 1.1211-1.1211 2.2383-1.1211 3.9219 0 1.1211-0.55859 2.8008-0.55859 3.9219 0 5.0391 2.2383 10.078 5.6016 14 1.1211 1.1211 1.6797 1.6797 2.8008 2.2383 1.1211 0.55859 2.2383 1.1211 3.3594 1.6797 1.1211 0.55859 2.2383 1.1211 3.9219 1.1211 1.1211 0 2.8008 0.55859 3.9219 0.55859 5.0391 0 10.078-2.2383 14-5.6016 1.1211-1.1211 1.6797-1.6797 2.2383-2.8008s1.1211-2.2383 1.6797-3.3594c0.55859-1.1211 1.1211-2.2383 1.1211-3.9219 0-1.1211 0.55859-2.8008 0.55859-3.9219s0-2.8008-0.55859-3.9219c-0.007813-1.1133-0.56641-2.2344-1.125-3.3516z"/>
                              </g>
                          </svg>

                          <div class="event-inf4">
                              <span class="event-inf2">{{ datep ? datep|date('d-m-Y') : label }}</span>
                              {% if customer is null and dateTimestamp %}
                                  <a href="{{ path('resa_potins_public',{'id':bookingEvent.id,'timestamp':dateTimestamp}) }}"
                                     class="nav1 btn btn-small">Je m'inscris</a>
                              {% endif %}
                          </div>
                      </div>
                  </div>

                  <div class="event-inf1">
                      <div class="event-info0">
                          <svg xmlns="http://www.w3.org/2000/svg" focusable="false" role="img" fill="currentColor"
                               width="700pt" height="700pt" viewBox="0 0 700 700" aria-hidden="true" class="info-svg">
                              <path
                                  d="m336.52 519.93c3.3281 4.0117 8.2656 6.332 13.477 6.332s10.148-2.3203 13.477-6.332l137.2-168c31.152-38.203 46.633-86.812 43.305-135.99-3.3242-49.184-25.207-95.266-61.219-128.93-36.016-33.66-83.469-52.383-132.76-52.383s-96.746 18.723-132.76 52.383c-36.012 33.66-57.895 79.742-61.219 128.93-3.3281 49.18 12.152 97.789 43.305 135.99zm13.477-413.7c32.488 0 63.648 12.906 86.621 35.879 22.973 22.973 35.879 54.129 35.879 86.621 0 32.488-12.906 63.645-35.879 86.617-22.973 22.977-54.133 35.883-86.621 35.883s-63.648-12.906-86.621-35.883c-22.973-22.973-35.879-54.129-35.879-86.617 0-32.492 12.906-63.648 35.879-86.621 22.973-22.973 54.133-35.879 86.621-35.879z"/>
                          </svg>
                          <div class="event-inf4">
                              {% if board %}
                                  <span class="event-inf2">{{ board.nameboard }}</span>
                                  {% if board.locality is defined and board.locality %}
                                      <div class="event-inf2">{{ board.locality.city }}</div>
                                  {% endif %}
                              {% endif %}
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  {% endfor %}

