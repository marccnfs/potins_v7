<main class="escape-container">

    <section class="intro">
        <h1>🎮 Crée ton propre Escape Game</h1>

        <div data-controller="hello">
            ...
        </div>

        {% if participant is defined %}
            <p>Bienvenue, <strong>{{ participant.prenom }}</strong> !</p>
        {% endif %}

        <p>
            Ton objectif : construire <strong>6 énigmes numériques</strong> pour créer ton propre escape game.
            Chaque énigme est guidée : tu auras un outil à découvrir, un objectif à atteindre et un lien à intégrer.
        </p>
        <p>Une fois toutes les énigmes créées, tu pourras tester ton jeu et le publier pour les autres !</p>
    </section>

    {% if participant is defined %}
        <section class="progression">
            <h2>🧩 Ta progression</h2>
            <ul class="escape-progress">
                {% for i in 1..6 %}
                    {% set state = stepStates[i]|default('locked') %}
                    <li class="escape-progress__step escape-progress__step--{{ state }}">
                        <span class="escape-progress__index">Étape {{ i }}</span>
                        {% if state == 'completed' %}
                            <span class="escape-progress__status">✅ Validée</span>
                        {% elseif state == 'current' %}
                            <span class="escape-progress__status">✨ En cours</span>
                        {% else %}
                            <span class="escape-progress__status">🔒 Verrouillée</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </section>

        <section class="etapes">

            {% set state = stepStates[currentStep]|default('locked') %}
            {% if state != 'locked' %}
                    <div class="etape-block">
                        <h3>🔧 Étape {{ currentStep }}</h3>
                        {% include 'pwa/escape/etape_template.html.twig' with {
                            'etape': currentStep,
                            'participant': participant,
                            'enigmes': enigmes,
                            'state': state,
                            'isCurrent': true
                        } %}
                    </div>
                {% else %}
                    <div class="etape-bloquee">
                        <p>🚫 Cette étape est encore verrouillée. Commence par compléter l'étape {{ currentStep - 1 }}.</p>
                    </div>
                {% endif %}
        </section>

        {% if progression|length == 6 %}
            <section class="validation">
                <h2>🎉 Ton jeu est prêt !</h2>
                <form method="post" action="{{ path('escape_publish') }}">
                    <button type="submit">Publier mon escape game</button>
                </form>
            </section>
        {% endif %}
    {% endif %}

    {% if participant is not defined or not participant %}
        <section class="visiteur-info" style="border:1px solid #ccc;padding:1em;margin:1em 0;background:#f9f9f9;">
            <p>👋 Tu explores l’escape game en tant que visiteur.</p>
            <p>Pour commencer à <strong>créer ton propre jeu</strong>, inscris-toi ci-dessous :</p>
            <a href="{{ path('participant_entry') }}" class="button" style="background:#3478f6;color:white;padding:0.5em 1em;text-decoration:none;border-radius:5px;">👉 Créer mon espace de jeu</a>
        </section>
    {% endif %}

</main>
