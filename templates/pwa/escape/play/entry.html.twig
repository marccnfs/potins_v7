{# templates/escape/garden.html.twig #}
{% block body %}
<div class="_wb">
    <div class="container_bo_member">
        <div class="bo_content">
            {% set total = 6 %}
            {% set done = 0 %}
            {% set steps = {
                1: 'Cryptex num√©rique',
                2: 'QR code g√©olocalis√©',
                3: 'Puzzle num√©rique',
                4: 'Formulaire logique',
                5: 'Vid√©o interactive',
                6: 'Code HTML minimal'
            } %}

            {# calc progression #}
            {% for i in 1..total %}
                {% set p = eg.getPuzzleByStep(i) %}
                {% if p and p.ready %}{% set done = done + 1 %}{% endif %}
            {% endfor %}
            {% set pct = (done / total * 100) | round(0, 'floor') %}
            <div class="play-layout">
                {# --- Colonne INFO --- #}
                <aside class="play-aside">
                    <div class="card">
                        <h3>üèÜ Meilleurs scores</h3>
                        <ol class="lb">
                            {% for row in topSessions %}
                                <li>
                                    <span class="nick">{{ row.participant.nickname ?? 'Joueur ' ~ row.participant.id }}</span>
                                    <span class="pts">{{ row.score }} pts</span>
                                    <span class="d">{{ (row.durationMs/1000)|round }} s</span>
                                </li>
                            {% else %}
                                <li class="muted">Aucun score pour l‚Äôinstant.</li>
                            {% endfor %}
                        </ol>
                    </div>
                </aside>
                <div class="entry-layout">

                <header class="entry-hero">
                    <div class="hero-body">
                        <h1 class="hero-title">{{ eg.title }}</h1>
                        {% if eg.universe %}
                            <p class="hero-sub">{{ eg.universe|join(' ') }}</p> {# ou eg.universe|nl2br selon ton format #}
                        {% else %}
                            <p class="hero-sub">Pr√™t¬∑e pour l‚Äôaventure ? R√©sous 6 √©preuves pour d√©voiler le secret‚Ä¶</p>
                        {% endif %}
                        <div class="hero-actions">
                            <a class="btn btn-primary" href="{{ path('play_step', { slug: eg.shareSlug, step: 1 }) }}">Commencer ‚Üí</a>
                            {% if done > 0 and done < total %}
                                <a class="btn btn-light" href="{{ path('play_step', { slug: eg.shareSlug, step: done + 1 }) }}">Reprendre √† l‚Äô√©tape {{ done + 1 }}</a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hero-progress">
                        <div class="bar"><span class="fill" style="width: {{ pct }}%"></span></div>
                        <div class="bar-caption">{{ done }}/{{ total }} √©preuves compl√©t√©es</div>
                    </div>
                </header>

                <main class="entry-main">
                    <section class="card">
                        <h2>Les √©preuves</h2>
                        <ol class="steps-list">
                            {% for i in 1..total %}
                                {% set p = eg.getPuzzleByStep(i) %}
                                {% set ready = p and p.ready %}
                                <li class="step-item {{ ready ? 'is-ready' : 'is-locked' }}">
                                    <div class="step-head">
                                        <div class="step-index">{{ i }}</div>
                                        <div class="step-title">{{ steps[i] }}</div>
                                        <div class="step-status">
                                            {% if ready %}
                                                <span class="badge badge-success">Pr√™te</span>
                                            {% else %}
                                                <span class="badge">Bient√¥t‚Ä¶</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="step-actions">
                                        {% if ready %}
                                            <a class="btn btn-light" href="{{ path('play_step', { slug: eg.shareSlug, step: i }) }}">Jouer l‚Äô√©tape {{ i }}</a>
                                        {% else %}
                                            <button class="btn" disabled>Indisponible</button>
                                        {% endif %}
                                    </div>
                                </li>
                            {% endfor %}
                        </ol>
                    </section>

                    <section class="card ambience">
                        <h2>Briefing</h2>
                        <p class="muted">Lis attentivement : chaque √©preuve te donnera un indice pour la suivante. Tu peux revenir √† cette page √† tout moment.</p>
                        <details class="tip">
                            <summary>Conseils pour r√©ussir</summary>
                            <ul>
                                <li>Observe tout : lettres, chiffres, couleurs, sons.</li>
                                <li>Parle avec ton √©quipe et partage vos id√©es.</li>
                                <li>Si tu bloques, fais une pause de 30 secondes, puis r√©essaie.</li>
                            </ul>
                        </details>
                    </section>
                </main>

            </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% use "js/js_escape.html.twig" %}
{% block javascripts %}
    {{ parent() }}
{% endblock %}
