{# templates/escape/garden.html.twig #}

{% block body %}
    <main class="escape-container">

        <section class="intro">
            <h1>ğŸ® CrÃ©e ton propre Escape Game</h1>

            {% if participant is defined %}
                <p>Bienvenue, <strong>{{ participant.prenom }}</strong> !</p>
            {% endif %}

            <p>
                Ton objectif : construire <strong>6 Ã©nigmes numÃ©riques</strong> pour crÃ©er ton propre escape game.
                Chaque Ã©nigme est guidÃ©e : tu auras un outil Ã  dÃ©couvrir, un objectif Ã  atteindre et un lien Ã  intÃ©grer.
            </p>
            <p>Une fois toutes les Ã©nigmes crÃ©Ã©es, tu pourras tester ton jeu et le publier pour les autres !</p>
        </section>

        {% if participant is defined %}
        <section class="progression">
            <h2>ğŸ§© Ta progression</h2>
            <ul class="escape-progress">
                {% for i in 1..6 %}
                    {% set state = stepStates[i]|default('locked') %}
                    <li class="escape-progress__step escape-progress__step--{{ state }}">
                        <span class="escape-progress__index">Ã‰tape {{ i }}</span>
                        {% if state == 'completed' %}
                            <span class="escape-progress__status">âœ… ValidÃ©e</span>
                        {% elseif state == 'current' %}
                            <span class="escape-progress__status">âœ¨ En cours</span>
                        {% else %}
                            <span class="escape-progress__status">ğŸ”’ VerrouillÃ©e</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </section>

        <section class="etapes">
            {% for i in 1..6 %}
                <div class="etape-block">
                    <h3>ğŸ”§ Ã‰tape {{ i }}</h3>
                    {% include 'pwa/escape/etape_template.html.twig' with {
                        'etape': i,
                        'participant': participant,
                        'enigmes': enigmes,
                        'state': stepStates[i]|default('locked'),
                        'isCurrent': currentStep is defined and currentStep == i
                    } %}
                </div>
            {% endfor %}
        </section>

        {% if progression|length == 6 %}
            <section class="validation">
                <h2>ğŸ‰ Ton jeu est prÃªt !</h2>
                <form method="post" action="{{ path('escape_publish') }}">
                    <button type="submit">Publier mon escape game</button>
                </form>
            </section>
        {% endif %}
    {% endif %}

        {% if participant is not defined or not participant %}
            <section class="visiteur-info" style="border:1px solid #ccc;padding:1em;margin:1em 0;background:#f9f9f9;">
                <p>ğŸ‘‹ Tu explores lâ€™escape game en tant que visiteur.</p>
                <p>Pour commencer Ã  <strong>crÃ©er ton propre jeu</strong>, inscris-toi ci-dessous :</p>
                <a href="{{ path('participant_entry') }}" class="button" style="background:#3478f6;color:white;padding:0.5em 1em;text-decoration:none;border-radius:5px;">ğŸ‘‰ CrÃ©er mon espace de jeu</a>
            </section>
        {% endif %}

    </main>
{% endblock %}
{% use "js/js_escape_act.html.twig" %}
{% block javascripts %}
    {{ parent() }}
{% endblock %}
