
    {# Variables attendues (toutes optionnelles) :
   - featuredGames: EscapeGame[] publi√©s et ‚Äúmis en avant‚Äù
   - recentGames: EscapeGame[] derniers publi√©s
   - myGames: EscapeGame[] (si app.user), jeux cr√©√©s par l‚Äôutilisateur
   - lastPlayed: { slug: string, title: string } (optionnel)
    #}

    <div class="home">

        {# --- HERO immersif --- #}
        <header class="hero">
            <div class="hero-inner">
                <p class="kicker">Escape Game num√©rique</p>
                <h1>Joue. Cr√©e. Partage.</h1>
                <p class="subtitle">R√©sous des √©nigmes en ligne, ou con√ßois les tiennes en 6 √©tapes ludiques. Seul¬∑e ou en √©quipe.</p>

                <div class="cta">
                    <a class="btn btn-primary" href="{{ path('catalog') }}">üéÆ Jouer maintenant</a>

                    {% if participant %}
                        <a class="btn" href="{{ path('wizard_start') }}">üõ†Ô∏è Cr√©er un escape</a>
                        {% if lastPlayed is defined and lastPlayed %}
                            <a class="btn btn-light" href="{{ path('play_entry', { slug: lastPlayed.slug }) }}">‚è±Ô∏è Reprendre : {{ lastPlayed.title|default('ma partie') }}</a>
                        {% endif %}
                   {# {% else %}
                        <a class="btn" href="{{ path('participant_entry') }}">üõ†Ô∏è Cr√©er un escape</a>
                        <a class="btn btn-light" href="{{ path('participant_login') }}">Se connecter</a>
                   #}
                    {% endif %}
                </div>

                <form class="search" method="get" action="{{ path('catalog') }}">
                    <input name="q" type="search" placeholder="Rechercher un escape (IA, Histoire, Enigmes...)">
                    <button class="btn" type="submit">Rechercher</button>
                </form>

                <ul class="trust">
                    <li>‚ú® 6 √©preuves pr√™tes √† l‚Äôemploi</li>
                    <li>üß© 100% jouable dans le navigateur</li>
                    <li>üì≤ Partage par simple lien</li>
                </ul>
            </div>
        </header>

        {# --- VITRINE : Jeux mis en avant --- #}
        {% set list = featuredGames|default([]) %}
        {% if list|length %}
            <section class="section">
                <h2>√Ä la une</h2>
                <div class="cards">
                    {% for eg in list %}
                        <article class="card">
                            <div class="thumb" aria-hidden="true">
                                {% set cover = eg.illustrations|first %}
                                {% if cover %}
                                    <img src="{{ vich_uploader_asset(cover, 'imageFile') }}" alt="{{ eg.title }}">
                                {% else %}
                                    <div class="ph"></div>
                                {% endif %}
                            </div>
                            <div class="meta">
                                <h3 class="title">{{ eg.title }}</h3>
                                <p class="desc">
                                    {% set uni = eg.universe|default(null) %}

                                    {% if uni is null %}
                                        Plonge dans une aventure‚Ä¶
                                    {% elseif uni is iterable %}
                                        {{ uni
                                        |map(u => u is iterable ? (u.name ?? u.label ?? u.title ?? '') : u)
                                        |filter(u => u is not empty and (u is not iterable))
                                        |join(' ')
                                        }}
                                    {% else %}
                                        {{ uni }}
                                    {% endif %}
                                </p>
                            </div>
                            <div class="actions">
                                <a class="btn btn-primary" href="{{ path('play_entry', { slug: eg.shareSlug }) }}">Jouer</a>
                                <a class="btn btn-light" href="{{ path('play_step', { slug: eg.shareSlug, step: 1 }) }}">Commencer</a>
                            </div>
                        </article>
                    {% endfor %}
                </div>
            </section>
        {% endif %}

        {# --- SECTION double : Comment √ßa marche (Jouer / Cr√©er) --- #}
        <section class="section grid2">
            <div class="panel">
                <h2>Jouer, c‚Äôest simple</h2>
                <ol class="steps">
                    <li><span class="step-index">1</span> Choisis un escape et lis le briefing.</li>
                    <li><span class="step-index">2</span> R√©sous 6 √©preuves : cryptex, QR g√©oloc ou cach√©, puzzle, logique, vid√©o, HTML.</li>
                    <li><span class="step-index">3</span> Gagne et partage ton score üéâ</li>
                </ol>
                <div class="micro-cta">
                    <a class="btn" href="{{ path('catalog') }}">Voir le catalogue</a>
                </div>
            </div>

            <div class="panel">
                <h2>Cr√©er en 6 √©tapes</h2>
                <ol class="steps">
                    <li><span class="step-index">1</span> D√©finis l‚Äôunivers et la consigne.</li>
                    <li><span class="step-index">2</span> Ajoute tes √©nigmes (texte, image, vid√©o‚Ä¶)</li>
                    <li><span class="step-index">3</span> Param√®tre indices, validation et messages.</li>
                    <li><span class="step-index">4</span> Publie & partage par lien.</li>
                </ol>
                <div class="micro-cta">
                    {% if app.user %}
                        <a class="btn btn-primary" href="{{ path('participant_entry') }}">D√©marrer la cr√©ation</a>
                    {% else %}
                        <a class="btn btn-primary" href="{{ path('participant_entry') }}">Cr√©er un compte</a>
                    {% endif %}
                </div>
            </div>
        </section>

        {# --- Si utilisateur connect√© : Mes escapes --- #}
        {% if participant and (myGames|default([]))|length %}
            <section class="section">
                <h2>Mes escapes</h2>
                <div class="cards">
                    {% for eg in myGames %}
                        <article class="card">
                            <div class="thumb">
                                {% set illu = eg.illustrations|first %}
                                {% if illu %}
                                    <img src="{{ vich_uploader_asset(illu, 'imageFile') }}" alt="{{ eg.title }}">
                                {% else %}
                                    <div class="ph"></div>
                                {% endif %}
                            </div>

                            <div class="meta">
                                <h3 class="title">{{ eg.title }}</h3>
                                <p class="desc muted">{{ eg.published ? 'Publi√©' : 'Brouillon' }} ¬∑ {{ eg.shareSlug }}</p>
                            </div>
                            <div class="actions">
                                <a class="btn" href="{{ path('wizard_overview', { id: eg.id }) }}">Modifier</a>
                                {% if eg.published and eg.shareSlug %}
                                    <a class="btn btn-light" href="{{ path('play_entry', { slug: eg.shareSlug }) }}">Voir c√¥t√© joueur</a>
                                {% else %}
                                    <a class="btn btn-light" href="{{ path('wizard_overview', { id: eg.id }) }}">Continuer</a>
                                {% endif %}
                            </div>
                        </article>
                    {% endfor %}
                </div>
            </section>
        {% endif %}

        {# --- Nouveaut√©s r√©centes --- #}
        {% set recent = recentGames|default([]) %}
        {% if recent|length %}
            <section class="section">
                <h2>Nouveaut√©s</h2>
                <div class="cards">
                    {% for eg in recent %}
                        <article class="card">
                            <div class="thumb">
                                {% set illu = eg.illustrations|first %}
                                {% if illu %}
                                    <img src="{{ vich_uploader_asset(illu, 'imageFile') }}" alt="{{ eg.title }}">
                                {% else %}
                                    <div class="ph"></div>
                                {% endif %}
                            </div>
                            <div class="meta">
                                <h3 class="title">{{ eg.title }}</h3>
                                <p class="desc">
                                    {% set uni = eg.universe|default(null) %}

                                    {% if uni is null %}
                                        Plonge dans une aventure‚Ä¶
                                    {% elseif uni is iterable %}
                                        {{ uni
                                        |map(u => u is iterable ? (u.name ?? u.label ?? u.title ?? '') : u)
                                        |filter(u => u is not empty and (u is not iterable))
                                        |join(' ')
                                        }}
                                    {% else %}
                                        {{ uni }}
                                    {% endif %}
                                </p>
                            </div>
                            <div class="actions">
                                <a class="btn btn-primary" href="{{ path('play_entry', { slug: eg.shareSlug }) }}">Jouer</a>
                            </div>
                        </article>
                    {% endfor %}
                </div>
            </section>
        {% endif %}

        {# --- Bloc ‚ÄúPour les animateurs / enseignants‚Äù --- #}
        <section class="section teach">
            <h2>Pour les animateurs & enseignants</h2>
            <ul class="bullets">
                <li>Atelier <strong>‚ÄúCr√©e ton escape game‚Äù</strong> pr√™t √† l‚Äôemploi (6 √©tapes guid√©es).</li>
                <li>Fonctionne en **classe enti√®re** ou **petits groupes**.</li>
                <li>Partage en un clic, **sans installation**.</li>
            </ul>
            <div class="micro-cta">
                <a class="btn" href="{{ path('participant_entry') }}">Lancer un atelier</a>
                <a class="btn btn-light" href="{{ path('docs_workshop') }}">Voir le guide</a>
            </div>
        </section>

        {# --- FAQ rapide --- #}
        <section class="section faq">
            <h2>Questions fr√©quentes</h2>
            <details>
                <summary>Est-ce gratuit ?</summary>
                <p>Oui pour jouer. La cr√©ation est incluse dans l‚Äôatelier. Certaines options avanc√©es peuvent √™tre activ√©es par l‚Äôanimateur.</p>
            </details>
            <details>
                <summary>Faut-il un compte pour jouer ?</summary>
                <p>Non. Un simple lien suffit. Pour <em>cr√©er</em> un escape, un compte est n√©cessaire.</p>
            </details>
            <details>
                <summary>Combien de temps dure un escape ?</summary>
                <p>Entre 10 et 30 minutes selon la difficult√© et le nombre d‚Äôindices utilis√©s.</p>
            </details>
        </section>

        {# --- Footer simple --- #}
        <footer class="footer">
            <p>¬© {{ "now"|date("Y") }} ‚Äî Escape num√©rique. <a href="{{ path('legal_mentions') }}">Mentions l√©gales</a> ¬∑ <a href="{{ path('privacy') }}">Vie priv√©e</a></p>
        </footer>
    </div>



