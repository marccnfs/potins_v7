<div class="container"
     data-controller="mindar-create"
     data-mindar-create-scenes-endpoint-value="{{ path('api_ar_scene_create') }}"
     data-mindar-create-upload-endpoint-value="{{ path('api_upload_mind') }}">
    <h1>Cr√©ateur de sc√®ne RA (MindAR)</h1>

    <form id="form-create">
        <div class="form-group">
            <label for="title">Titre de la sc√®ne</label>
            <input type="text"
                   id="title"
                   name="title"
                   data-mindar-create-target="title"
                   placeholder="Ma sc√®ne RA"
                   value="">
        </div>

        <!-- S√©lecteur de pack -->
        <div class="form-group mb-4">
            <label for="pack" class="block text-sm font-medium text-gray-700 mb-1">
                Pack d'images cibles
            </label>
            <p class="text-xs text-gray-500 mb-2">Choisissez le pack contenant les images de suivi MindAR.</p>

            <select id="pack"
                    name="pack"
                    class="form-select w-full rounded border border-gray-300 p-2"
                    data-mindar-create-target="pack"
                    data-action="change->mindar-create#packChanged">

                {% for pack in packs %}
                    <option value="{{ pack.mindPath }}"
                            data-packname="{{ pack.name }}"
                        {% if pack.jsonPath is defined and pack.jsonPath %}
                            data-json="{{ pack.jsonPath }}"
                        {% endif %}
                        {% if pack.thumbnail is defined and pack.thumbnail %}
                            data-thumbnail="{{ pack.thumbnail }}"
                        {% endif %}
                        {% set items = pack.metadata.items ?? [] %}
                        {% if items is not empty %}
                        data-items='{{ items|json_encode|e('html_attr') }}'
                        {% endif %}>
                        {{ pack.name }}
                    </option>
                {% else %}
                    <option disabled selected>Aucun pack disponible</option>
                {% endfor %}
            </select>

            <div id="pack-preview"
                 class="pack-preview-wrapper mt-3"
                 data-mindar-create-target="packPreview">
                <p class="text-sm text-gray-500">S√©lectionnez un motif pour afficher un aper√ßu.</p>
            </div>
        </div>

        <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="targetIndex">
                Motif de reconnaissance
            </label>
            <p class="text-xs text-gray-500 mb-2">Cliquez sur l'une des images du pack pour d√©finir la cible MindAR utilis√©e pour l'ancrage 3D.</p>

            <div class="target-grid" data-mindar-create-target="thumbs">
                <p class="text-sm text-gray-500">Aucun pack MindAR d√©tect√© pour le moment.</p>
            </div>
            <p class="text-xs text-blue-700 mt-2" data-mindar-create-target="targetInfo">
                S√©lectionnez une image pour confirmer la d√©tection MindAR.
            </p>
            <input type="hidden" id="targetIndex" name="targetIndex" value="0" data-mindar-create-target="targetIndex">
        </div>

        {% set hasModels = models is defined and models|length > 0 %}

        <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="model">
                Mod√®le 3D
            </label>
            <p class="text-xs text-gray-500 mb-3">Choisissez l'animation 3D affich√©e lorsque l'image d√©clencheur est d√©tect√©e.</p>

            <input type="hidden" id="model" name="model" data-mindar-create-target="model" value="{{ hasModels ? models|first.path : '' }}">

            {% if hasModels %}
                <div class="model-grid" data-mindar-create-target="modelChoices">
                    {% for model in models %}
                        <button type="button"
                                class="model-card"
                                data-mindar-create-target="modelChoice"
                                data-action="mindar-create#selectModel"
                                data-model-path="{{ model.path }}"
                                data-model-name="{{ model.name }}"
                                data-model-description="{{ model.description|default('') }}"
                                data-model-emoji="{{ model.emoji|default('') }}"
                                {% if loop.first %}data-model-default="1"{% endif %}>
                            <span class="model-card__icon" aria-hidden="true">{{ model.emoji|default('üßä') }}</span>
                            <span class="model-card__title">{{ model.name }}</span>
                            {% if model.description is defined and model.description %}
                                <span class="model-card__description">{{ model.description }}</span>
                            {% endif %}
                        </button>
                    {% endfor %}
                </div>
                <div class="model-info" data-mindar-create-target="modelInfo">
                    <p class="text-xs text-gray-500">S√©lectionnez un mod√®le pour afficher ses d√©tails.</p>
                </div>
            {% else %}
                <div class="alert alert-warning">
                    Aucun mod√®le 3D n'est disponible pour le moment.
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="sound">Ambiance sonore</label>
            <select id="sound" name="sound" data-mindar-create-target="sound">
                <option value="">Aucune</option>
                <option value="/build/audio/forest.mp3">For√™t</option>
                <option value="/build/audio/water.mp3">Eau</option>
            </select>
        </div>

        <div class="form-group">
            <label for="mindfile">Fichier cible (.mind)</label>
            <input type="file" id="mindfile" accept=".mind" data-mindar-create-target="mindfile" />
        </div>

        <div class="form-group">
            <button type="button" class="btn" data-action="mindar-create#preview">Pr√©visualiser</button>
            <button type="button" class="btn btn-secondary" data-action="mindar-create#save">Enregistrer la sc√®ne</button>
        </div>
    </form>

    <div class="divider"></div>

    <div id="preview" class="preview" data-mindar-create-target="preview">
        <div class="preview-placeholder">
            <p><em>La sc√®ne appara√Ætra ici apr√®s la pr√©visualisation.</em></p>
        </div>
    </div>
</div>
