<div class="container"
     data-controller="mindar-create"
     data-mindar-create-scenes-endpoint-value="{{ path('api_ar_scene_create') }}"
     data-mindar-create-upload-endpoint-value="{{ path('api_upload_mind') }}">
    <h1>Créateur de scène RA (MindAR)</h1>

    <form id="form-create">
        <div class="form-group">
            <label for="title">Titre de la scène</label>
            <input type="text"
                   id="title"
                   name="title"
                   data-mindar-create-target="title"
                   placeholder="Ma scène RA"
                   value="">
        </div>

        <!-- Sélecteur de pack -->
        <div class="form-group mb-4">
            <label for="pack" class="block text-sm font-medium text-gray-700 mb-1">
                Pack d'images cibles
            </label>
            <p class="text-xs text-gray-500 mb-2">Choisissez le pack contenant les images de suivi MindAR.</p>

            <select id="pack"
                    name="pack"
                    class="form-select w-full rounded border border-gray-300 p-2"
                    data-mindar-create-target="pack"
                    data-action="change->mindar-create#packChanged">

                {% for pack in packs %}
                    <option value="{{ pack.mindPath }}"
                            data-packname="{{ pack.name }}"
                        {% if pack.jsonPath is defined and pack.jsonPath %}
                            data-json="{{ pack.jsonPath }}"
                        {% endif %}
                        {% if pack.thumbnail is defined and pack.thumbnail %}
                            data-thumbnail="{{ pack.thumbnail }}"
                        {% endif %}
                        {% set items = pack.metadata.items ?? [] %}
                        {% if items is not empty %}
                        data-items='{{ items|json_encode|e('html_attr') }}'
                        {% endif %}>
                        {{ pack.name }}
                    </option>
                {% else %}
                    <option disabled selected>Aucun pack disponible</option>
                {% endfor %}
            </select>

            <div id="pack-preview"
                 class="pack-preview-wrapper mt-3"
                 data-mindar-create-target="packPreview">
                <p class="text-sm text-gray-500">Sélectionnez un motif pour afficher un aperçu.</p>
            </div>
        </div>

        <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="targetIndex">
                Motif de reconnaissance
            </label>
            <p class="text-xs text-gray-500 mb-2">Cliquez sur l'une des images du pack pour définir la cible MindAR utilisée pour l'ancrage 3D.</p>

            <div class="target-grid" data-mindar-create-target="thumbs">
                <p class="text-sm text-gray-500">Aucun pack MindAR détecté pour le moment.</p>
            </div>
            <input type="hidden" id="targetIndex" name="targetIndex" value="0" data-mindar-create-target="targetIndex">
        </div>

        <div class="form-group">
            <label for="model">Modèle 3D</label>
            <select id="model" name="model" data-mindar-create-target="model">
                <option value="/build/models/lotus.glb">Lotus</option>
                <option value="/build/models/rock.glb">Pierre</option>
                <option value="/build/models/bamboo.glb">Bambou</option>
            </select>
        </div>

        <div class="form-group">
            <label for="sound">Ambiance sonore</label>
            <select id="sound" name="sound" data-mindar-create-target="sound">
                <option value="">Aucune</option>
                <option value="/build/audio/forest.mp3">Forêt</option>
                <option value="/build/audio/water.mp3">Eau</option>
            </select>
        </div>

        <div class="form-group">
            <label for="mindfile">Fichier cible (.mind)</label>
            <input type="file" id="mindfile" accept=".mind" data-mindar-create-target="mindfile" />
        </div>

        <div class="form-group">
            <button type="button" class="btn" data-action="mindar-create#preview">Prévisualiser</button>
            <button type="button" class="btn btn-secondary" data-action="mindar-create#save">Enregistrer la scène</button>
        </div>
    </form>

    <div class="divider"></div>

    <div id="preview" class="preview" data-mindar-create-target="preview">
        <div class="preview-placeholder">
            <p><em>La scène apparaîtra ici après la prévisualisation.</em></p>
        </div>
    </div>
</div>
