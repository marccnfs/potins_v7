{# templates/pwa/escape/<directory>/menu.html.twig #}
{#
Attentes :
  - participant (objet Participant ou null)
  - brand_route (string)  ‚Äî route de la page d‚Äôaccueil (d√©faut : 'potins_index')
  - nav (array de routes)
  - active (string)       ‚Äî cl√© de l‚Äôonglet actif : 'play'|'create'|'mine'|'docs'
#}

{% set brand_route = brand_route|default('potins_index') %}
{% set active = active|default('') %}
{% set nav = nav|default({
    plan:     'plan_bleu',
    basic:     'basic',
    eventhanding: 'event_handing',
    interactive:  'interactive',
    fcts:     'face_tracking_1',
    fctc:     'face_tracking_2',
    prepareur: 'ar_prepareur',
    create:    'ar_mindar_create',
    gallery:   'ar_gallery',
}) %}

<header class="xnav" data-controller="xnav">
    <div class="xnav__inner">

        {# --- Logo / Accueil --- #}
        <a class="xnav__brand" href="{{ path(brand_route) }}" aria-label="Accueil">
            <div class="navlogo-game">
                {{ include('svg/potins/logopotins_svg_small.html.twig') }}
            </div>
            <span class="xnav__logo">üß©</span>
            <span class="xnav__brandname">R√©alit√© augment√©e</span>
        </a>

        {# --- Navigation principale --- #}
        <nav class="xnav__links" aria-label="Navigation principale">

            {# Sous-menu d√©mo #}
            <div class="dropdown">
                <button class="xnav__link {{ active == 'demo' ? 'is-active' }}" aria-haspopup="true" aria-expanded="false">
                    D√©mo <i class="fa fa-chevron-down"></i>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="{{ path(nav.plan) }}" class="souslink-bar">plan</a></li>
                    <li><a href="{{ path(nav.basic) }}" class="souslink-bar">basic</a></li>
                    <li><a href="{{ path(nav.interactive) }}" class="souslink-bar">interactive</a></li>
                    <li><a href="{{ path(nav.eventhanding) }}" class="souslink-bar">eventhanding</a></li>
                    <li><a href="{{ path(nav.fcts) }}" class="souslink-bar">face traking simple</a></li>
                    <li><a href="{{ path(nav.fctc) }}" class="souslink-bar">face traking complet</a></li>
                    <li><a href="{{ path(nav.prepareur) }}" class="souslink-bar">Pr√©parateur</a></li>
                </ul>
            </div>

            {# Autres liens #}
            <a class="xnav__link {{ active == 'gallery' ? 'is-active' }}" href="{{ path(nav.gallery) }}">
                Liste des sc√®nes
            </a>
            <a class="xnav__link {{ active == 'create' ? 'is-active' }}" href="{{ path(nav.create) }}">
                Cr√©ation de sc√®ne
            </a>

        </nav>

        {# Optionnel : bouton compte ou menu mobile (si tu veux les r√©activer) #}
        <button id="xnav-burger" class="xnav__burger" aria-label="Menu mobile" aria-expanded="false">
            <i class="fa fa-bars"></i>
        </button>

        <div class="xnav__account">
            <button id="xnav-account-btn" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-user"></i>
            </button>
            <div id="xnav-account-menu" class="xnav__account-menu" hidden>
                <a href="#">Profil</a>
                <a href="#">D√©connexion</a>
            </div>
        </div>

    </div>
</header>

{# --- Script d‚Äôinteraction menu / burger --- #}
<script>
    (function () {
        const burger = document.getElementById('xnav-burger');
        const links  = document.querySelector('.xnav__links');
        const btn    = document.getElementById('xnav-account-btn');
        const menu   = document.getElementById('xnav-account-menu');

        // Burger mobile
        if (burger && links) {
            burger.addEventListener('click', () => {
                const open = links.classList.toggle('is-open');
                burger.setAttribute('aria-expanded', open ? 'true' : 'false');
                if (menu && !menu.hidden) {
                    menu.hidden = true;
                    btn?.setAttribute('aria-expanded', 'false');
                }
            });
        }

        // Menu compte
        if (btn && menu) {
            btn.addEventListener('click', () => {
                const isHidden = menu.hidden;
                menu.hidden = !isHidden;
                btn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            });
            document.addEventListener('click', (e) => {
                if (!menu.hidden && !menu.contains(e.target) && e.target !== btn && !btn.contains(e.target)) {
                    menu.hidden = true;
                    btn.setAttribute('aria-expanded', 'false');
                }
            });
        }
    })();
</script>
